from vaccine_progress_bot import application
from vaccine_progress_bot import basic_auth
from vaccine_progress_bot.models import TwitterClient
from flask import render_template
import pandas as pd

SOURCE = 'https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/vaccinations/country_data/Nepal.csv'
POPULATION = 29674920.0
comp = ['█','░']

progress_bar = {0: '░░░░░░░░░░░░░░░',
 1: '░░░░░░░░░░░░░░░',
 2: '░░░░░░░░░░░░░░░',
 3: '░░░░░░░░░░░░░░░',
 4: '▓░░░░░░░░░░░░░░',
 5: '▓░░░░░░░░░░░░░░',
 6: '▓░░░░░░░░░░░░░░',
 7: '▓░░░░░░░░░░░░░░',
 8: '▓░░░░░░░░░░░░░░',
 9: '▓░░░░░░░░░░░░░░',
 10: '▓▓░░░░░░░░░░░░░',
 11: '▓▓░░░░░░░░░░░░░',
 12: '▓▓░░░░░░░░░░░░░',
 13: '▓▓░░░░░░░░░░░░░',
 14: '▓▓░░░░░░░░░░░░░',
 15: '▓▓░░░░░░░░░░░░░',
 16: '▓▓░░░░░░░░░░░░░',
 17: '▓▓▓░░░░░░░░░░░░',
 18: '▓▓▓░░░░░░░░░░░░',
 19: '▓▓▓░░░░░░░░░░░░',
 20: '▓▓▓░░░░░░░░░░░░',
 21: '▓▓▓░░░░░░░░░░░░',
 22: '▓▓▓░░░░░░░░░░░░',
 23: '▓▓▓░░░░░░░░░░░░',
 24: '▓▓▓▓░░░░░░░░░░░',
 25: '▓▓▓▓░░░░░░░░░░░',
 26: '▓▓▓▓░░░░░░░░░░░',
 27: '▓▓▓▓░░░░░░░░░░░',
 28: '▓▓▓▓░░░░░░░░░░░',
 29: '▓▓▓▓░░░░░░░░░░░',
 30: '▓▓▓▓▓░░░░░░░░░░',
 31: '▓▓▓▓▓░░░░░░░░░░',
 32: '▓▓▓▓▓░░░░░░░░░░',
 33: '▓▓▓▓▓░░░░░░░░░░',
 34: '▓▓▓▓▓░░░░░░░░░░',
 35: '▓▓▓▓▓░░░░░░░░░░',
 36: '▓▓▓▓▓░░░░░░░░░░',
 37: '▓▓▓▓▓▓░░░░░░░░░',
 38: '▓▓▓▓▓▓░░░░░░░░░',
 39: '▓▓▓▓▓▓░░░░░░░░░',
 40: '▓▓▓▓▓▓░░░░░░░░░',
 41: '▓▓▓▓▓▓░░░░░░░░░',
 42: '▓▓▓▓▓▓░░░░░░░░░',
 43: '▓▓▓▓▓▓░░░░░░░░░',
 44: '▓▓▓▓▓▓▓░░░░░░░░',
 45: '▓▓▓▓▓▓▓░░░░░░░░',
 46: '▓▓▓▓▓▓▓░░░░░░░░',
 47: '▓▓▓▓▓▓▓░░░░░░░░',
 48: '▓▓▓▓▓▓▓░░░░░░░░',
 49: '▓▓▓▓▓▓▓░░░░░░░░',
 50: '▓▓▓▓▓▓▓▓░░░░░░░',
 51: '▓▓▓▓▓▓▓▓░░░░░░░',
 52: '▓▓▓▓▓▓▓▓░░░░░░░',
 53: '▓▓▓▓▓▓▓▓░░░░░░░',
 54: '▓▓▓▓▓▓▓▓░░░░░░░',
 55: '▓▓▓▓▓▓▓▓░░░░░░░',
 56: '▓▓▓▓▓▓▓▓░░░░░░░',
 57: '▓▓▓▓▓▓▓▓▓░░░░░░',
 58: '▓▓▓▓▓▓▓▓▓░░░░░░',
 59: '▓▓▓▓▓▓▓▓▓░░░░░░',
 60: '▓▓▓▓▓▓▓▓▓░░░░░░',
 61: '▓▓▓▓▓▓▓▓▓░░░░░░',
 62: '▓▓▓▓▓▓▓▓▓░░░░░░',
 63: '▓▓▓▓▓▓▓▓▓░░░░░░',
 64: '▓▓▓▓▓▓▓▓▓▓░░░░░',
 65: '▓▓▓▓▓▓▓▓▓▓░░░░░',
 66: '▓▓▓▓▓▓▓▓▓▓░░░░░',
 67: '▓▓▓▓▓▓▓▓▓▓░░░░░',
 68: '▓▓▓▓▓▓▓▓▓▓░░░░░',
 69: '▓▓▓▓▓▓▓▓▓▓░░░░░',
 70: '▓▓▓▓▓▓▓▓▓▓▓░░░░',
 71: '▓▓▓▓▓▓▓▓▓▓▓░░░░',
 72: '▓▓▓▓▓▓▓▓▓▓▓░░░░',
 73: '▓▓▓▓▓▓▓▓▓▓▓░░░░',
 74: '▓▓▓▓▓▓▓▓▓▓▓░░░░',
 75: '▓▓▓▓▓▓▓▓▓▓▓░░░░',
 76: '▓▓▓▓▓▓▓▓▓▓▓░░░░',
 77: '▓▓▓▓▓▓▓▓▓▓▓▓░░░',
 78: '▓▓▓▓▓▓▓▓▓▓▓▓░░░',
 79: '▓▓▓▓▓▓▓▓▓▓▓▓░░░',
 80: '▓▓▓▓▓▓▓▓▓▓▓▓░░░',
 81: '▓▓▓▓▓▓▓▓▓▓▓▓░░░',
 82: '▓▓▓▓▓▓▓▓▓▓▓▓░░░',
 83: '▓▓▓▓▓▓▓▓▓▓▓▓░░░',
 84: '▓▓▓▓▓▓▓▓▓▓▓▓▓░░',
 85: '▓▓▓▓▓▓▓▓▓▓▓▓▓░░',
 86: '▓▓▓▓▓▓▓▓▓▓▓▓▓░░',
 87: '▓▓▓▓▓▓▓▓▓▓▓▓▓░░',
 88: '▓▓▓▓▓▓▓▓▓▓▓▓▓░░',
 89: '▓▓▓▓▓▓▓▓▓▓▓▓▓░░',
 90: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓░',
 91: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓░',
 92: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓░',
 93: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓░',
 94: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓░',
 95: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓░',
 96: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓░',
 97: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓',
 98: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓',
 99: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓',
 100: '▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓'}

@application.route('/')
def hello():
    return ('future home of vaccine bot nepal')

@application.route('/get_data')
@basic_auth.required
def get_data():
    data = pd.read_csv(SOURCE).iloc[-1].to_dict()
    percentage_fully_vaccinated = round(100*data.get('people_fully_vaccinated')/POPULATION, 3)
    percentage_partially_vaccinated = round(100*data.get('people_vaccinated')/POPULATION, 3)
    final = "Fully Vaccinated\n" +\
    progress_bar.get(int(percentage_fully_vaccinated)) +" "+str(percentage_fully_vaccinated) +"%"+\
    "\n\n" +\
    "Partially Vaccinated\n" +\
    progress_bar.get(int(percentage_partially_vaccinated)) +" "+str(percentage_partially_vaccinated) +"%"+\
    "\n" +\
    ' Latest Data ---> ' + data.get('date')
    return final
    

@application.route('/post_tweet')
@basic_auth.required
def post_tweet():
    twitter_client = TwitterClient()
    tweet_text = get_data()
    twitter_client.post_tweet(tweet_text)
    return 'done'
